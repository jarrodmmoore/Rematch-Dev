#gameTime is used for command timing
scoreboard players add @e[name=Global,type=armor_stand,x=0,y=50,z=49,dx=1,dy=1,dz=1] gameTime 1

#guidebook
execute as @a[tag=guidebook] unless entity @s[nbt={Inventory:[{id:"minecraft:written_book",Slot:8b}]}] at @s run clear @s minecraft:written_book
execute as @a[gamemode=adventure,tag=guidebook] if entity @e[scores={gameState=3},name=Global,type=armor_stand,x=0,y=50,z=49,dx=1,dy=1,dz=1] unless entity @s[nbt={Inventory:[{id:"minecraft:written_book",Slot:8b}]}] run item replace entity @s hotbar.8 with minecraft:written_book[minecraft:written_book_content={author:"the Rematch development team",pages:[{raw:'["",{"text":"Welcome to ","type":"text"},{"text":"Rematch!","bold":true,"color":"gold","type":"text"},{"text":"\\n\\nThis ","color":"white","type":"text"},{"text":"Guidebook","italic":true,"type":"text"},{"text":" will help you master the tips & tricks to the map!\\n\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" Words with \\"","color":"white","type":"text"},{"text":"[ ]","bold":true,"type":"text"},{"text":"\\" are clickable!\\n\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" The ","color":"white","type":"text"},{"text":"Guidebook","italic":true,"type":"text"},{"text":"\\nwill update depending on what part of the game you are in.","color":"white","type":"text"}]'},{raw:'["",{"text":"Note:","color":"dark_red","type":"text"},{"text":" The ","color":"white","type":"text"},{"text":"Guidebook","italic":true,"type":"text"},{"text":"\\ncan be disabled using the Tutorial Villager in the main lobby.\\n\\n","color":"white","type":"text"},{"text":"New to the game?","italic":true,"color":"dark_purple","type":"text"},{"text":"\\nClick to check out the ","color":"white","type":"text"},{"text":"Tutorial Book!","italic":true,"color":"dark_green","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"[Click here]","bold":true,"color":"dark_gray","clickEvent":{"action":"run_command","value":"/trigger tut_click set 1"},"hoverEvent":{"action":"show_text","contents":{"text":"Click for a copy!","italic":true,"color":"light_purple","type":"text"}},"type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" The ","color":"white","type":"text"},{"text":"Tutorial Book","italic":true,"color":"dark_green","type":"text"},{"text":" contains links to all editions of the ","color":"white","type":"text"},{"text":"Guidebook!","italic":true,"type":"text"}]'},{raw:'["",{"text":"Phase Three: PVP","bold":true,"type":"text"},{"text":"\\n\\nFight against your friends in a free-for-all elimination battle! Use your items to your advantage, because if you run out of lives, you are eliminated.","color":"white","type":"text"}]'},{raw:'["",{"text":"Deathmatch","bold":true,"type":"text"},{"text":"\\n\\nBe careful... if the game stalls for too long, a deathmatch will initiate. All players will be confined in a shrinking border with only one life!","color":"white","type":"text"}]'},{raw:'["",{"text":"Teams","bold":true,"type":"text"},{"text":"\\n4+ players","italic":true,"type":"text"},{"text":"\\n\\nIn teams mode, all players are split into two separate teams. If everybody on one team is eliminated, the other team wins! Pay attention to your items because they could end up saving your team!","color":"white","type":"text"}]'}],title:{raw:"Guidebook"}},minecraft:lore=['"A guidebook to help you understand the \\"nitty-gritty\\" of the map."']]

#cutting the logic here into four sub-phases for layout creation, startup, gameplay, and end sequence
execute if entity @e[scores={gameTime=..0},name=Global,type=armor_stand,x=0,y=50,z=49,dx=1,dy=1,dz=1] run function rematch:game/pvp/layout
execute if entity @e[scores={gameTime=1..205},name=Global,type=armor_stand,x=0,y=50,z=49,dx=1,dy=1,dz=1] run function rematch:game/pvp/startup_sequence
execute if entity @e[scores={gameTime=181..99999},name=Global,type=armor_stand,x=0,y=50,z=49,dx=1,dy=1,dz=1] run function rematch:game/pvp/_main_logic
execute if entity @e[scores={gameTime=100000..},name=Global,type=armor_stand,x=0,y=50,z=49,dx=1,dy=1,dz=1] run function rematch:game/pvp/end_sequence

return 1