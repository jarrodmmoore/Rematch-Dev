#part 2 of _initialize
execute if entity @e[scores={countdown=220},name=Global] run function rematch:game/gather/gather_timer

#countdown before phase 1
execute if entity @e[scores={countdown=1..},name=Global] run function rematch:text/gather_messages/countdown_5
execute if entity @e[scores={countdown=5},name=Global] run function rematch:text/announce_phase/phase1

#tp and generation
execute if entity @e[scores={countdown=2..71},name=Global] run function rematch:game/gather/generation_tick

#effects / items given at end of countdown
execute if entity @e[scores={countdown=220},name=Global] run function rematch:game/gather/start_players
execute if entity @e[scores={countdown=220},name=Global] run function rematch:text/gather_messages/events

#always give effects
execute unless entity @e[scores={countdown=..500},name=Global] run effect give @a[team=players] minecraft:speed 100000 2 true
execute unless entity @e[scores={countdown=..500},name=Global] run function help:e8c792688f11dacf062e06bdbeac3e1d32927460feede0fcb8b1f9f2877a5645

#==============================================
#new rounds of livestock and monsters
execute if entity @e[scores={timer=1},name=Global] run function rematch:game/gather/respawn_resources/_check
#==============================================

#resets inventory during phase (not needed anymore)
#execute as @e[scores={drop_redst_block=1..}] at @s run playsound minecraft:block.note_block.bass master @s ~ ~ ~ 1 0
#execute as @e[scores={drop_redst_block=1..}] at @s run function rematch:game/gather/give_items_specific
#execute as @e[scores={drop_redst_block=1..}] run scoreboard players reset @s drop_redst_block

#make sure all players have tools
tag @a[tag=hasTools] remove hasTools
tag @a[team=!spectators,nbt={Inventory:[{components:{"minecraft:custom_data":{Tags:["tool1"]}},Slot:0b},{components:{"minecraft:custom_data":{Tags:["tool2"]}},Slot:2b},{components:{"minecraft:custom_data":{Tags:["tool3"]}},Slot:3b},{components:{"minecraft:custom_data":{Tags:["tool4"]}},Slot:4b},{components:{"minecraft:custom_data":{Tags:["tool5"]}},Slot:5b},{components:{"minecraft:custom_data":{Tags:["tool6"]}},Slot:6b},{components:{"minecraft:custom_data":{Tags:["tool7"]}},Slot:-106b}]}] add hasTools
execute as @a[gamemode=adventure,tag=!hasTools,team=!spectators] run function rematch:text/gather_messages/give_items

#sea lantern commands
execute if entity @e[scores={countdown=400..},name=Global] as @a[scores={drop_sea_lantern=1..,inputCooldown=..0}] at @s run function rematch:game/gather/use_sea_lantern
scoreboard players reset @a drop_sea_lantern
scoreboard players remove @a[scores={inputCooldown=1..}] inputCooldown 1

#basket changes
execute as @a[scores={berries_picked=5}] run function rematch:game/gather/basket_change
execute as @a[scores={berries_picked=11}] run function rematch:game/gather/basket_change
execute as @a[scores={berries_picked=17}] run function rematch:game/gather/basket_change

#kill tools
kill @e[type=minecraft:item,nbt={Item:{components:{"minecraft:custom_data":{Tags:["killonground"]}}}}]

#==============================================
#certain entities will only run logic when a player is within 10m of them
tag @e[tag=entNearby] remove entNearby
execute as @a[gamemode=adventure,team=players] at @s run tag @e[distance=..15,tag=checkProximity,tag=!entNearby] add entNearby
#==============================================

#bee commands
execute as @e[tag=purple_bee,tag=entNearby] at @s run function rematch:game/gather/purple_bee_behave

#bookshelf commands
function rematch:game/gather/bookshelf_particles

#berry commands
execute as @e[tag=blackberry,tag=entNearby] at @s run function rematch:game/gather/berry_behave

#chest commands
execute as @e[tag=chest,tag=entNearby] at @s run function rematch:game/gather/chest_behave

#guidebook
execute as @a[tag=guidebook] unless entity @s[nbt={Inventory:[{id:"minecraft:written_book",Slot:8b}]}] at @s run clear @s minecraft:written_book
execute as @a[gamemode=adventure,tag=guidebook] if entity @e[scores={gameState=1},name=Global] unless entity @s[nbt={Inventory:[{id:"minecraft:written_book",Slot:8b}]}] run item replace entity @s hotbar.8 with minecraft:written_book[minecraft:written_book_content={author:"the Rematch development team",pages:[{raw:'["",{"text":"Welcome to ","type":"text"},{"text":"Rematch!","bold":true,"color":"gold","type":"text"},{"text":"\\n\\nThis ","color":"white","type":"text"},{"text":"Guidebook","italic":true,"type":"text"},{"text":" will help you master the tips & tricks to the map!\\n\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" Words with \\"","color":"white","type":"text"},{"text":"[ ]","bold":true,"type":"text"},{"text":"\\" are clickable!\\n\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" The ","color":"white","type":"text"},{"text":"Guidebook","italic":true,"type":"text"},{"text":"\\nwill update depending on what part of the game you are in.","color":"white","type":"text"}]'},{raw:'["",{"text":"Note:","color":"dark_red","type":"text"},{"text":" The ","color":"white","type":"text"},{"text":"Guidebook","italic":true,"type":"text"},{"text":"\\ncan be disabled using the Tutorial Villager in the main lobby.\\n\\n","color":"white","type":"text"},{"text":"New to the game?","italic":true,"color":"dark_purple","type":"text"},{"text":"\\nClick to check out the ","color":"white","type":"text"},{"text":"Tutorial Book!","italic":true,"color":"dark_green","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"[Click here]","bold":true,"color":"dark_gray","clickEvent":{"action":"run_command","value":"/trigger tut_click set 1"},"hoverEvent":{"action":"show_text","contents":{"text":"Click for a copy!","italic":true,"color":"light_purple","type":"text"}},"type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" The ","color":"white","type":"text"},{"text":"Tutorial Book","italic":true,"color":"dark_green","type":"text"},{"text":" contains links to all editions of the ","color":"white","type":"text"},{"text":"Guidebook!","italic":true,"type":"text"}]'},{raw:'["",{"text":"Phase One: Gathering","bold":true,"type":"text"},{"text":"\\n\\nThe purpose of this phase is to interact with the environment and gather as many coins as possible. You will be given tools in order to harvest materials and slay monsters.","color":"white","type":"text"}]'},{raw:'["",{"text":"The Three Islands","bold":true,"color":"dark_green","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"Each island has unique interactions.","italic":true,"type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"\\u2b27 [Cave Island]","bold":true,"color":"gray","clickEvent":{"action":"change_page","value":5},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"},{"text":"\\n","color":"white","bold":true,"type":"text"},{"text":"\\u2b27 [Farm Island]","bold":true,"color":"red","clickEvent":{"action":"change_page","value":10},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"},{"text":"\\n","color":"white","bold":true,"type":"text"},{"text":"\\u2b27 [Forest Island]","bold":true,"color":"green","clickEvent":{"action":"change_page","value":15},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"},{"text":"\\n\\nOther Interactions\\n","color":"white","bold":true,"type":"text"},{"text":"\\u2b27 [Fishing]","bold":true,"color":"dark_blue","clickEvent":{"action":"change_page","value":18},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"},{"text":"\\n","color":"white","bold":true,"type":"text"},{"text":"\\u2b27 [Chests]","bold":true,"color":"gold","clickEvent":{"action":"change_page","value":24},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"\\u2b27 [Events]","bold":true,"color":"light_purple","clickEvent":{"action":"change_page","value":25},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"\\u2b27 [Rarities]","bold":true,"color":"dark_purple","clickEvent":{"action":"change_page","value":26},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"}]'},{raw:'["",{"text":"Cave Island","bold":true,"color":"gray","type":"text"},{"text":"\\n\\nThis island features custom mines and frequently-spawning monsters. A list of all possible interactions for this island starts on the next page.\\n ","color":"white","type":"text"}]'},{raw:'["",{"text":"Iron ore","color":"dark_green","type":"text"},{"text":" (Pickaxe)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 5 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Lapis ore","color":"dark_green","type":"text"},{"text":" (Pickaxe)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 5 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Redstone ore","color":"dark_green","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"(Pickaxe) ","color":"gray","type":"text"},{"text":"+ 8 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Gold ore","color":"gold","type":"text"},{"text":" (Pickaxe)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 12 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Diamond ore ","color":"gold","type":"text"},{"text":"(Pickaxe)\\n ","color":"gray","type":"text"},{"text":"+ 16 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Emerald ore","color":"dark_red","type":"text"},{"text":" (Pickaxe)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 32 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Skeleton","color":"dark_red","type":"text"},{"text":" (Sword)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 16 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Zombie","color":"dark_red","type":"text"},{"text":" (Sword)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 16 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Piglin","color":"dark_red","type":"text"},{"text":" (Sword)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 20 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Husk","color":"dark_red","type":"text"},{"text":" (Sword)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 20 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Wither skeleton","color":"dark_purple","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":" + 24 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Zombie Villager","color":"dark_purple","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":" + 24 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Stray","color":"dark_purple","type":"text"},{"text":" (Sword)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 32 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Drowned","color":"dark_purple","type":"text"},{"text":" (Sword)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 32 coins","color":"gold","type":"text"},{"text":"\\n ","color":"white","type":"text"}]'},{raw:'["",{"text":"Note:","color":"dark_red","type":"text"},{"text":" There are a few other monsters, but they have a very small chance of spawning. If you see one, it yields a large sum of coins!\\n\\n\\n\\n\\n\\n\\n","color":"white","type":"text"},{"text":"[Return]","bold":true,"color":"dark_gray","clickEvent":{"action":"change_page","value":4},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"}]'},{raw:'["",{"text":"Farm Island","bold":true,"color":"red","type":"text"},{"text":"\\n\\nThis island features vast fields of crops, a barn full of hay and livestock, and a small farmhouse. A list of all possible interactions for this island starts on the next page.","color":"white","type":"text"}]'},{raw:'["",{"text":"Wheat ","color":"dark_green","type":"text"},{"text":"(Hoe)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 1 coin","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Carrot ","color":"dark_green","type":"text"},{"text":"(Hoe)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 1 coin","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Potatoes ","color":"dark_green","type":"text"},{"text":"(Hoe)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 1 coin","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Beetroot ","color":"dark_green","type":"text"},{"text":"(Hoe)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 5 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Hay bale ","color":"dark_green","type":"text"},{"text":"(Hoe)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 3 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Bookshelf ","color":"gold","type":"text"},{"text":"(Axe)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 10 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Chicken ","color":"gold","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 6 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Pig ","color":"gold","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 6 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Cow ","color":"gold","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 6 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Sheep ","color":"gold","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 6 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Rabbit ","color":"dark_red","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 12 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Horse ","color":"dark_red","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 12 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Llama ","color":"dark_red","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 12 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Ocelot ","color":"dark_red","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 12 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Donkey ","color":"dark_purple","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 24 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Tamed cat ","color":"dark_purple","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 24 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Trader llama ","color":"dark_purple","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 36 coins","color":"gold","type":"text"},{"text":" \\n\\n","color":"white","type":"text"},{"text":"Saddled pig ","color":"dark_purple","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 36 coins","color":"gold","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" There are a few other, very rare animals. If you see one, it yields a large sum of coins!\\n","color":"white","type":"text"},{"text":"[Return]","bold":true,"color":"dark_gray","clickEvent":{"action":"change_page","value":4},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"}]'},{raw:'["",{"text":"Forest Island","bold":true,"color":"green","type":"text"},{"text":"\\n\\nThis island features trees, bees, wolves, berries, and a cabin. It\'s the bee\'s knees! A list of all possible interactions for this island starts on the next page.\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" The trees on this island are the only breakable trees on the entire map.","color":"white","type":"text"}]'},{raw:'["",{"text":"Wood","color":"dark_green","type":"text"},{"text":" \\u27a1","color":"gray","type":"text"},{"text":" Spruce, Birch, Jungle","italic":true,"color":"gray","type":"text"},{"text":" (Axe)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 2 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Leaves","color":"dark_green","type":"text"},{"text":" \\u27a1","color":"gray","type":"text"},{"text":" Spruce, Birch, Jungle ","italic":true,"color":"gray","type":"text"},{"text":"(Axe)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 2 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Coconut ","color":"dark_green","type":"text"},{"text":"(Axe)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 1 coin","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Bookshelf ","color":"gold","type":"text"},{"text":"(Axe)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 10 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Wolf ","color":"dark_red","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 16 coins\\n\\nBerry ","color":"gold","type":"text"},{"text":"(Hand)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 10 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Beenest ","color":"gold","type":"text"},{"text":"(Axe)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 10 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Bee ","color":"gold","type":"text"},{"text":"(Sword)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 10 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Purple Bee ","color":"dark_purple","type":"text"},{"text":"(Hand)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 32 coins \\u0020","color":"gold","type":"text"},{"text":"[Return]","bold":true,"color":"dark_gray","clickEvent":{"action":"change_page","value":4},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"}]'},{raw:'["",{"text":"Fishing","bold":true,"color":"dark_blue","type":"text"},{"text":"\\n\\nFishing is fairly self-explanatory: using the fishing rod, fish up goodies worth coins. A list of all possible interactions for fishing starts on the next page.\\n","color":"white","type":"text"},{"text":"Note:","color":"dark_red","type":"text"},{"text":" Collecting coins at islands is typically more rewarding than fishing.","color":"white","type":"text"}]'},{raw:'["",{"text":"Cod ","color":"dark_red","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 16 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Salmon ","color":"dark_red","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":" + 20 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Pufferfish ","color":"dark_red","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 20 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Tropical Fish","color":"dark_red","type":"text"},{"text":" (Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 20 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Bow ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 30 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Enchanted book","color":"dark_purple","type":"text"},{"text":" (Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 40 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Fishing rod ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 30 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Name tag","color":"dark_purple","type":"text"},{"text":" (Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 36 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Nautilus Shell ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 100 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Saddle ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 40 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Lily pad ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 36 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Bowl ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 30 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Leather ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 30 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Leather boots ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 40 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Rotten flesh ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 24 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Stick ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 24 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"String ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 24 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Water bottle ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 30 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Bone ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 24 coins","color":"gold","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Ink sac ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 30 coins","color":"gold","type":"text"}]'},{raw:'["",{"text":"Tripwire hook ","color":"dark_purple","type":"text"},{"text":"(Rod)","color":"gray","type":"text"},{"text":"\\n ","color":"white","type":"text"},{"text":"+ 24 coins","color":"gold","type":"text"},{"text":"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n","color":"white","type":"text"},{"text":"[Return]","bold":true,"color":"dark_gray","clickEvent":{"action":"change_page","value":4},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"}]'},{raw:'["",{"text":"Chests","bold":true,"color":"gold","type":"text"},{"text":"\\n\\nChests are scattered all across the map. They can be worth ","color":"white","type":"text"},{"text":"1, 2, 4, 8, 16, 32, 48","bold":true,"type":"text"},{"text":",","color":"white","type":"text"},{"text":" or","type":"text"},{"text":" 64","bold":true,"type":"text"},{"text":" coins, and can be grabbed using your hands. Be on the lookout for them, because they are quite valueable!\\n\\n","color":"white","type":"text"},{"text":"[Return]","bold":true,"color":"dark_gray","clickEvent":{"action":"change_page","value":4},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"}]'},{raw:'["",{"text":"Events","bold":true,"color":"light_purple","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"If enabled,","underlined":true,"type":"text"},{"text":" one island a round has a change of producing ","color":"white","type":"text"},{"text":"increased coins!","bold":true,"type":"text"},{"text":" The caves could yield surplus ore, the farm could have a bountiful harvest, or the forest could suffer from overgrowth. Who knows?\\n","color":"white","type":"text"},{"text":"[Return]","color":"dark_gray","bold":true,"clickEvent":{"action":"change_page","value":4},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"}]'},{raw:'["",{"text":"Rarities","bold":true,"color":"dark_purple","type":"text"},{"text":"\\n\\n","color":"white","type":"text"},{"text":"Green","color":"dark_green","type":"text"},{"text":" \\u0020\\u27a1 ","color":"white","type":"text"},{"text":"1-5 coins","color":"gold","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"Yellow","color":"gold","type":"text"},{"text":" \\u0020\\u27a1 ","color":"white","type":"text"},{"text":"6-10 coins","color":"gold","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"Red ","color":"dark_red","type":"text"},{"text":" \\u0020 \\u0020\\u27a1 ","color":"white","type":"text"},{"text":"11-20 coins","color":"gold","type":"text"},{"text":"\\n","color":"white","type":"text"},{"text":"Purple","color":"dark_purple","type":"text"},{"text":" \\u27a1 ","color":"white","type":"text"},{"text":"21+ coins","color":"gold","type":"text"},{"text":"\\n\\n\\n\\n\\n\\n\\n\\n","color":"white","type":"text"},{"text":"[Return]","bold":true,"color":"dark_gray","clickEvent":{"action":"change_page","value":4},"hoverEvent":{"action":"show_text","contents":{"text":"Click to swap pages!","italic":true,"color":"light_purple","type":"text"}},"type":"text"}]'}],title:{raw:"Guidebook"}},minecraft:lore=['"A guidebook to help you understand the \\"nitty-gritty\\" of the map."']]

#minutes operations
scoreboard players operation @e[name=Global] minutes = @e[name=Global] globalTimer
scoreboard players operation @e[name=Global] minutes /= @e[name=Global] math_minute

#seconds operations
scoreboard players operation @e[name=Global] seconds = @e[name=Global] globalTimer
scoreboard players operation @e[name=Global] seconds %= @e[name=Global] math_minute

#detect color of bossbar
scoreboard players operation @e[name=Global] isGreen = @e[name=Global] globalTimer
scoreboard players operation @e[name=Global] isGreen -= @e[name=Global] yellow
scoreboard players operation @e[name=Global] isYellow = @e[name=Global] globalTimer
scoreboard players operation @e[name=Global] isYellow -= @e[name=Global] red
scoreboard players operation @e[name=Global] isRed = @e[name=Global] globalTimer
scoreboard players operation @e[name=Global] isRed -= @e[name=Global] red

#change color of bossbar
execute if entity @e[scores={isGreen=1..},name=Global] run bossbar set minecraft:timer color green
execute if entity @e[scores={isGreen=..0,isYellow=1..},name=Global] run bossbar set minecraft:timer color yellow
execute if entity @e[scores={isYellow=..0},name=Global] run bossbar set minecraft:timer color red

#timer commands
execute as @e[tag=secondsCount] run scoreboard players add @s timer 1
execute as @e[tag=secondsCount,scores={timer=20}] run scoreboard players remove @s globalTimer 1
execute as @e[tag=secondsCount,scores={timer=20}] run scoreboard players set @s timer 0
execute store result bossbar minecraft:timer value run scoreboard players get @e[tag=secondsCount,limit=1] globalTimer
execute as @e[tag=secondsCount,scores={globalTimer=0}] run bossbar set timer visible false
execute as @e[tag=secondsCount,scores={globalTimer=0}] run tag @s remove secondsCount
execute if entity @e[tag=secondsCount] run function rematch:text/gather_messages/bossbar

#announce times
execute if entity @e[tag=secondsCount] run function rematch:text/gather_messages/time_left

#exchanges, divided into functions of varying frequencies depending on how often they need to be checked
scoreboard players add @e[name=Global] frequencyA 1
scoreboard players add @e[name=Global] frequencyB 1
scoreboard players add @e[name=Global] frequencyC 1
scoreboard players add @e[name=Global] frequencyD 1
scoreboard players set @e[scores={frequencyA=2..},name=Global] frequencyA 1
scoreboard players set @e[scores={frequencyB=8..},name=Global] frequencyB 1
scoreboard players set @e[scores={frequencyC=10..},name=Global] frequencyC 1
scoreboard players set @e[scores={frequencyD=21..},name=Global] frequencyD 1
function rematch:game/gather/exchange_check/rapid
execute if entity @e[scores={frequencyA=1},name=Global] run function rematch:game/gather/exchange_check/frequency_a
execute if entity @e[scores={frequencyB=1},name=Global] run function rematch:game/gather/exchange_check/frequency_b
execute if entity @e[scores={frequencyC=1},name=Global] run function rematch:game/gather/exchange_check/frequency_c
execute if entity @e[scores={frequencyD=1},name=Global] run function rematch:game/gather/exchange_check/frequency_d

#ending phase (leave at bottom)
execute if entity @e[scores={globalTimer=0},name=Global] run scoreboard players reset @a berries_picked
execute if entity @e[scores={globalTimer=0},name=Global] run function rematch:game/shop/_initialize
return 1